<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="ðŸš© Using redflag with sklearn" href="Using_redflag_with_sklearn.html" /><link rel="prev" title="ðŸš© Installation" href="../installation.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>ðŸš© Basic usage - redflag documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">redflag  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/redflag_logo.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">ðŸš© Installation</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">ðŸš© Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="Using_redflag_with_sklearn.html">ðŸš© Using <code class="docutils literal notranslate"><span class="pre">redflag</span></code> with <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../redflag.html">redflag package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/redflag/">PyPI releases</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/agilescientific/redflag">Code in GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/agilescientific/redflag/issues">Issue tracker</a></li>
<li class="toctree-l1"><a class="reference external" href="https://code.agilescientific.com/community">Community guidelines</a></li>
<li class="toctree-l1"><a class="reference external" href="https://code.agilescientific.com">Agile's software</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.agilescientific.com">Agile's website</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="basic-usage">
<h1>ðŸš© Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this heading">#</a></h1>
<p><strong>Welcome to <code class="docutils literal notranslate"><span class="pre">redflag</span></code>.</strong> Itâ€™s still early days for this library, but there are a few things you can do:</p>
<ul class="simple">
<li><p>Outlier detection</p></li>
<li><p>Clipping detection</p></li>
<li><p>Imbalance metrics (for labels and any other categorical variables)</p></li>
<li><p>Distribution shape</p></li>
<li><p>Identical distribution assumption</p></li>
<li><p>Independence assumption</p></li>
<li><p>Feature importance metrics</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">redflag</span> <span class="k">as</span> <span class="nn">rf</span>

<span class="n">rf</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">redflag</span> <span class="k">as</span> <span class="nn">rf</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">rf</span><span class="o">.</span><span class="n">__version__</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;redflag&#39;
</pre></div>
</div>
</div>
</div>
<section id="load-some-data">
<h2>Load some data<a class="headerlink" href="#load-some-data" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://geocomp.s3.amazonaws.com/data/Panoma_training_data.csv&#39;</span><span class="p">)</span>

<span class="c1"># Look at the transposed summary: each column in the DataFrame is a row here.</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Depth</th>
      <td>3966.0</td>
      <td>882.674555</td>
      <td>40.150056</td>
      <td>784.402800</td>
      <td>858.012000</td>
      <td>888.339600</td>
      <td>913.028400</td>
      <td>963.320400</td>
    </tr>
    <tr>
      <th>RelPos</th>
      <td>3966.0</td>
      <td>0.524999</td>
      <td>0.286375</td>
      <td>0.010000</td>
      <td>0.282000</td>
      <td>0.531000</td>
      <td>0.773000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Marine</th>
      <td>3966.0</td>
      <td>1.325013</td>
      <td>0.589539</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>GR</th>
      <td>3966.0</td>
      <td>64.367899</td>
      <td>28.414603</td>
      <td>12.036000</td>
      <td>45.311250</td>
      <td>64.840000</td>
      <td>78.809750</td>
      <td>200.000000</td>
    </tr>
    <tr>
      <th>ILD</th>
      <td>3966.0</td>
      <td>5.240308</td>
      <td>3.190416</td>
      <td>0.340408</td>
      <td>3.169567</td>
      <td>4.305266</td>
      <td>6.664234</td>
      <td>32.136605</td>
    </tr>
    <tr>
      <th>DeltaPHI</th>
      <td>3966.0</td>
      <td>3.469088</td>
      <td>4.922310</td>
      <td>-21.832000</td>
      <td>1.000000</td>
      <td>3.292500</td>
      <td>6.124750</td>
      <td>18.600000</td>
    </tr>
    <tr>
      <th>PHIND</th>
      <td>3966.0</td>
      <td>13.008807</td>
      <td>6.936391</td>
      <td>0.550000</td>
      <td>8.196250</td>
      <td>11.781500</td>
      <td>16.050000</td>
      <td>52.369000</td>
    </tr>
    <tr>
      <th>PE</th>
      <td>3966.0</td>
      <td>3.686427</td>
      <td>0.815113</td>
      <td>0.200000</td>
      <td>3.123000</td>
      <td>3.514500</td>
      <td>4.241750</td>
      <td>8.094000</td>
    </tr>
    <tr>
      <th>Facies</th>
      <td>3966.0</td>
      <td>4.471004</td>
      <td>2.406180</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>4.000000</td>
      <td>6.000000</td>
      <td>9.000000</td>
    </tr>
    <tr>
      <th>LATITUDE</th>
      <td>3966.0</td>
      <td>37.632575</td>
      <td>0.299398</td>
      <td>37.180732</td>
      <td>37.356426</td>
      <td>37.500380</td>
      <td>37.910583</td>
      <td>38.063373</td>
    </tr>
    <tr>
      <th>LONGITUDE</th>
      <td>3966.0</td>
      <td>-101.294895</td>
      <td>0.230454</td>
      <td>-101.646452</td>
      <td>-101.389189</td>
      <td>-101.325130</td>
      <td>-101.106045</td>
      <td>-100.987305</td>
    </tr>
    <tr>
      <th>ILD_log10</th>
      <td>3966.0</td>
      <td>0.648860</td>
      <td>0.251542</td>
      <td>-0.468000</td>
      <td>0.501000</td>
      <td>0.634000</td>
      <td>0.823750</td>
      <td>1.507000</td>
    </tr>
    <tr>
      <th>RHOB</th>
      <td>3966.0</td>
      <td>2288.861692</td>
      <td>218.038459</td>
      <td>1500.000000</td>
      <td>2201.007475</td>
      <td>2342.202051</td>
      <td>2434.166399</td>
      <td>2802.871147</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="categorical-or-continuous">
<h2>Categorical or continuous?<a class="headerlink" href="#categorical-or-continuous" title="Permalink to this heading">#</a></h2>
<p>Itâ€™s fairly easy to tell if a column is numeric or not, but harder to decide if itâ€™s continuous or categorical. We can use <code class="docutils literal notranslate"><span class="pre">is_continuous()</span></code> to check if a feature (or the target) is continuous. It uses heuristics and is definitely not foolproof. <code class="docutils literal notranslate"><span class="pre">redflag</span></code> uses it internally sometimes to decide how to treat a feature or target.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">:</span><span class="s2">&gt;20s</span><span class="si">}</span><span class="s2"> ... </span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">is_continuous</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           Well Name ... False
               Depth ... True
           Formation ... False
              RelPos ... True
              Marine ... False
                  GR ... True
                 ILD ... True
            DeltaPHI ... True
               PHIND ... True
                  PE ... True
              Facies ... False
            LATITUDE ... True
           LONGITUDE ... True
           ILD_log10 ... True
           Lithology ... False
                RHOB ... True
          Mineralogy ... False
       Siliciclastic ... False
</pre></div>
</div>
</div>
</div>
<p>These are all correct.</p>
</section>
<section id="imbalance-metrics">
<h2>Imbalance metrics<a class="headerlink" href="#imbalance-metrics" title="Permalink to this heading">#</a></h2>
<p>First, weâ€™ll look at measuring imbalance in the target using <code class="docutils literal notranslate"><span class="pre">rf.class_imbalance()</span></code>. For binary targets, the metric is imbalace ratio (ratio between majority and minority class). For multiclass targets, the metric is imbalance degree <a class="reference external" href="https://doi.org/10.1016/j.patrec.2017.08.002">(Ortigosa-Hernandez et al, 2017)</a>, a single-value measure that explains (a) how many minority classes there are and (b) how skewed the supports are.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span><span class="o">.</span><span class="n">imbalance_degree</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lithology&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.347368420878391
</pre></div>
</div>
</div>
</div>
<p>To interpret this number, split it into two parts:</p>
<ul class="simple">
<li><p>The integer part, 3, is equal to <span class="math notranslate nohighlight">\(m - 1\)</span>, where <span class="math notranslate nohighlight">\(m\)</span> is the number of minority classes.</p></li>
<li><p>The fractional part, 0.378â€¦, is a measure of the amount of imbalance, where 0 means the dataset is balanced perfectly and 0.999â€¦ is really bad.</p></li>
</ul>
<p>If the imbalance degree is -1 then there are no minority classes and all the classes have equal support.</p>
<p>In general, this statistic is more informative than the commonly used â€˜imbalance ratioâ€™ (<code class="docutils literal notranslate"><span class="pre">rf.imbalance_ratio()</span></code>), which is the ratio of support in the maximum majority class to that in the minimum minority class, with no regard for the support of the other classes.</p>
<p>We can get the minority classes, which are those with fewer samples than expected. These are returned in order, smallest first:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span><span class="o">.</span><span class="n">minority_classes</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lithology&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;dolomite&#39;, &#39;sandstone&#39;, &#39;mudstone&#39;, &#39;wackestone&#39;], dtype=&#39;&lt;U10&#39;)
</pre></div>
</div>
</div>
</div>
<p>We can get the â€˜empirical distributionâ€™, which returns the observed frequencies <code class="docutils literal notranslate"><span class="pre">Î¶</span></code> and the expectations <code class="docutils literal notranslate"><span class="pre">e</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Î¶</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">empirical_distribution</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lithology&#39;</span><span class="p">])</span>
<span class="n">Î¶</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.39989914, 0.18582955, 0.15834594, 0.04790721, 0.13691377,
       0.07110439])
</pre></div>
</div>
</div>
</div>
<p>These are in the same order as <code class="docutils literal notranslate"><span class="pre">df['Lithology'].unique()</span></code> (note that this is different from the order of <code class="docutils literal notranslate"><span class="pre">np.unique()</span></code>, which is sorted).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lithology&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;siltstone&#39;, &#39;limestone&#39;, &#39;wackestone&#39;, &#39;dolomite&#39;, &#39;mudstone&#39;,
       &#39;sandstone&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>We can also inspect the distribution using Pandas; note that this display is sorted by count:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lithology&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>

<span class="c1"># Add a line at the expectation level, which is the same for all classes.</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.lines.Line2D at 0x7fa93be70640&gt;
</pre></div>
</div>
<img alt="../_images/41d377ac8a3075388147c7da4b3d33769d941f54973c8e20999d1b39c63d2853.png" src="../_images/41d377ac8a3075388147c7da4b3d33769d941f54973c8e20999d1b39c63d2853.png" />
</div>
</div>
</section>
<section id="outliers">
<h2>Outliers<a class="headerlink" href="#outliers" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">get_outliers()</span></code> function detects outliers, returning the indices of outlier points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outliers</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">get_outliers</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;GR&#39;</span><span class="p">])</span>
<span class="n">outliers</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 301,  302,  303,  415,  416,  417,  418,  799,  896,  897,  898,
        899,  996,  997, 1843, 1844, 2278, 2279, 2280, 2638, 2639, 2640,
       2641, 2642, 2643, 2920, 2921, 2922, 3070, 3071, 3074, 3075, 3076,
       3079, 3080, 3081, 3580, 3581, 3582, 3583])
</pre></div>
</div>
</div>
</div>
<p>We can see where these lie in the distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;GR&#39;</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">rugplot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">outliers</span><span class="p">,</span> <span class="s1">&#39;GR&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;GR&#39;, ylabel=&#39;Density&#39;&gt;
</pre></div>
</div>
<img alt="../_images/fa2225113c2debc69385bc53ada322f0a5c92c3de09510bd447204ab55b49121.png" src="../_images/fa2225113c2debc69385bc53ada322f0a5c92c3de09510bd447204ab55b49121.png" />
</div>
</div>
<p>By default it uses an <a class="reference external" href="https://scikit-learn.org/stable/modules/outlier_detection.html#isolation-forest"><strong>isolation forest</strong></a> to detect the outliers at the 99% confidence level, but you can also opt to use <strong>local outlier factor</strong>, <strong>elliptic envelope</strong>, or <strong>Mahalanobis distance</strong>, setting the confidence level to choose how many outliers you will see, or (equivalently) setting the <code class="docutils literal notranslate"><span class="pre">threshold</span></code> to the number of standard deviations away from the mean you regard as signal.</p>
<p>The function accepts univariate or multivariate data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GR&#39;</span><span class="p">,</span> <span class="s1">&#39;PE&#39;</span><span class="p">]</span>

<span class="n">outliers</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">get_outliers</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mah&#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;GR&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">index_to_bool</span><span class="p">(</span><span class="n">outliers</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.JointGrid at 0x7fa93925b6d0&gt;
</pre></div>
</div>
<img alt="../_images/f97be8fa3c56b76b02bd3b9179ae7f929d8eeb2b0734237fc2b6bbae2c672afa.png" src="../_images/f97be8fa3c56b76b02bd3b9179ae7f929d8eeb2b0734237fc2b6bbae2c672afa.png" />
</div>
</div>
<p>A helper function can compute the number of expected outliers, given the dataset size and assuming a Gaussian distribution of samples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;We have </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">)</span><span class="si">}</span><span class="s2"> outliers, but expect:&quot;</span><span class="p">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">expected_outliers</span><span class="p">(</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We have 80 outliers, but expect:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>44
</pre></div>
</div>
</div>
</div>
<p>So we have more than expected â€” because the distribution of GR has a lot of clipped samples at a value of 200. A dataset with truncated tails will have fewer than expected outliers; we can test this directly with the <code class="docutils literal notranslate"><span class="pre">has_outliers()</span></code> function, which compares the results of <code class="docutils literal notranslate"><span class="pre">expected_outliers()</span></code> with <code class="docutils literal notranslate"><span class="pre">get_outliers()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10_000</span><span class="p">)</span>

<span class="n">rf</span><span class="o">.</span><span class="n">expected_outliers</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Truncate</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="o">-</span><span class="mf">2.5</span> <span class="o">&lt;</span> <span class="n">data</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span> <span class="o">&lt;</span>  <span class="mf">2.5</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x7fa9360fe970&gt;
</pre></div>
</div>
<img alt="../_images/c5560064bd5f84197a5a11005538f8c3857d67639c48b768f042cb7603a31df8.png" src="../_images/c5560064bd5f84197a5a11005538f8c3857d67639c48b768f042cb7603a31df8.png" />
</div>
</div>
<p>This truncated normal distribution has no outliers (there are only about 60, compared to the 100 we expect at this confidence level of 99% on this dataset of 10,000 records).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span><span class="o">.</span><span class="n">has_outliers</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
</section>
<section id="clipping">
<h2>Clipping<a class="headerlink" href="#clipping" title="Permalink to this heading">#</a></h2>
<p>If a feature has been clipped, it will have multiple instances at its min and/or max value. There are legitimate reasons why this might happen, for example the feature may be naturally bounded (e.g. porosity is always greater than 0), or the feature may have been deliberately clipped as part of the data preparation process.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span><span class="o">.</span><span class="n">is_clipped</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;GR&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;GR&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x7fa936004250&gt;
</pre></div>
</div>
<img alt="../_images/15aaa6f274695a2b8fc158a59ae302f97d2f5d3209530e422edd84469828a9ed.png" src="../_images/15aaa6f274695a2b8fc158a59ae302f97d2f5d3209530e422edd84469828a9ed.png" />
</div>
</div>
</section>
<section id="distribution-shape">
<h2>Distribution shape<a class="headerlink" href="#distribution-shape" title="Permalink to this heading">#</a></h2>
<p>Tries to guess the shape of the distribution from the following set from <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'norm'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'cosine'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'expon'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'exponpow'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'gamma'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'gumbel_l'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'gumbel_r'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'powerlaw'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'triang'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'trapz'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'uniform'</span></code></p></li>
</ul>
<p>The name is returned, along with the shape parameters (if any), location and scale.</p>
<p>In spite of the outliers, we find that the distribution of GR values is nearly normal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span><span class="o">.</span><span class="n">best_distribution</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;GR&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Distribution(name=&#39;norm&#39;, shape=[], loc=64.36789939485628, scale=28.411020184908292)
</pre></div>
</div>
</div>
</div>
<p>In contrast, the PHIND data is skewed andbest modeled by the <a class="reference external" href="https://en.wikipedia.org/wiki/Gumbel_distribution">Gumbel distribution</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span><span class="o">.</span><span class="n">best_distribution</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;PHIND&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Distribution(name=&#39;gumbel_r&#39;, shape=[], loc=10.040572536302586, scale=4.934329727517257)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;PHIND&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x7fa93472ae20&gt;
</pre></div>
</div>
<img alt="../_images/d29917f3bd4dab7f91906cd4bef1b4ef2890cddde5bc69bc9cada914ded1d39b.png" src="../_images/d29917f3bd4dab7f91906cd4bef1b4ef2890cddde5bc69bc9cada914ded1d39b.png" />
</div>
</div>
</section>
<section id="identical-distribution-assumption">
<h2>Identical distribution assumption<a class="headerlink" href="#identical-distribution-assumption" title="Permalink to this heading">#</a></h2>
<p>Weâ€™d often like to test the implicit assumption that our data are â€˜identically distributedâ€™ across various groups, with respect to both the labels and the features.</p>
<p><code class="docutils literal notranslate"><span class="pre">redflag.wasserstein()</span></code> facilitates calculating the first Wasserstein distance (aka earth-moverâ€™s distance) between groups, e.g. between train and test datasets. It returns a score for each feature; scores greater than 1 can be interpreted as substantial differences in the distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wells</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Well Name&#39;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GR&#39;</span><span class="p">,</span> <span class="s1">&#39;RHOB&#39;</span><span class="p">,</span> <span class="s1">&#39;ILD_log10&#39;</span><span class="p">,</span> <span class="s1">&#39;PE&#39;</span><span class="p">]</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">wasserstein</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">],</span> <span class="n">groups</span><span class="o">=</span><span class="n">wells</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">w</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.25985545, 0.28404634, 0.49139232, 0.33701782],
       [0.22736457, 0.13473663, 0.33672956, 0.20969657],
       [0.41216725, 0.34568777, 0.39729747, 0.48092099],
       [0.0801856 , 0.10675027, 0.13740318, 0.10325295],
       [0.19913347, 0.21828753, 0.26995735, 0.33063277],
       [0.24612402, 0.23889923, 0.26699721, 0.2350674 ],
       [0.20666445, 0.44112543, 0.16229232, 0.63527036],
       [0.18187639, 0.34992043, 0.19400917, 0.74988182],
       [0.31761526, 0.27206283, 0.30255291, 0.24779581]])
</pre></div>
</div>
</div>
</div>
<p>You could plot this as a heatmap:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">wells</span><span class="p">),</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/cab75b111779a86b1d0aaad35a8ad28e4ba87d0a2a62b9d9430018969eb9d004.png" src="../_images/cab75b111779a86b1d0aaad35a8ad28e4ba87d0a2a62b9d9430018969eb9d004.png" />
</div>
</div>
<p>This shows us that the distributions of the PE log in well indices 6 and 7 are somewhat different and may be anomalous. It also suggests that the CROSS H CATTLE well is different from the others.</p>
<section id="already-split-out-group-arrays">
<h3>Already split out group arrays<a class="headerlink" href="#already-split-out-group-arrays" title="Permalink to this heading">#</a></h3>
<p>If you have groups that are already split out, e.g. train and test datasets:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># NOTE: We&#39;re doing a random split here for illustration purposes only.</span>
<span class="c1"># This is not a valid way to split the dataset, because rows are not indepedent.</span>
<span class="n">X_val</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># The data should be standardized to compare Wasserstein distance between features.</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_val</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In this case, you can pass them into the function as a list or tuple:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span><span class="o">.</span><span class="n">wasserstein</span><span class="p">([</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">X_test</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.03860982, 0.02506236, 0.04321734, 0.03437337],
       [0.04402681, 0.02528225, 0.0385111 , 0.05694201],
       [0.04388196, 0.049464  , 0.05560379, 0.04002712]])
</pre></div>
</div>
</div>
</div>
<p>The numbers are all quite low because we sampled randomly from the data.</p>
</section>
</section>
<section id="independence-assumption">
<h2>Independence assumption<a class="headerlink" href="#independence-assumption" title="Permalink to this heading">#</a></h2>
<p>If a feature is correlated to lagged (shifted) versions of itself, then the dataset may be ordered by that feature, or the records may not be independent. If several features are correlated to themselves, then the data instances may not be independent.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span><span class="o">.</span><span class="n">is_correlated</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;GR&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>This is order-dependent. That is, shuffling the data removes the correlation, but does not mean the records are independent.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gr</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;GR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">is_correlated</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
</section>
<section id="feature-importance">
<h2>Feature importance<a class="headerlink" href="#feature-importance" title="Permalink to this heading">#</a></h2>
<p>Weâ€™d like to know which features are the most important.</p>
<p><code class="docutils literal notranslate"><span class="pre">redflag</span></code> trains a series of models on your data, assessing which features are most important. It then normalizes and averages the results.</p>
<p>To serve as a â€˜controlâ€™, letâ€™s add a column of small random numbers that we know is not useful. Weâ€™d expect this column to come out with very low importance (i.e. close to zero).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Random&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Constant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>First, a <strong>classification task</strong>. Imagine weâ€™re trying to predict lithology from well logs. Which are the most important logs?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GR&#39;</span><span class="p">,</span> <span class="s1">&#39;ILD_log10&#39;</span><span class="p">,</span> <span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="s1">&#39;Random&#39;</span><span class="p">,</span> <span class="s1">&#39;Constant&#39;</span><span class="p">]</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Lithology&#39;</span><span class="p">]</span>

<span class="n">importances</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">feature_importances</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">importances</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.26212942, 0.36516684, 0.2869616 , 0.08298919, 0.        ])
</pre></div>
</div>
</div>
</div>
<p>This tells us that the most important features are, in order: ILD, PE, GR, with the random and constant variables unsurprisingly useless.</p>
<p>Thereâ€™s a function to help us decide which are the least important features; it returns the indices of the least useful features, in order (least useful first):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span><span class="o">.</span><span class="n">least_important_features</span><span class="p">(</span><span class="n">importances</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([4, 3])
</pre></div>
</div>
</div>
</div>
<p>And a complementary function reporting the most important:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span><span class="o">.</span><span class="n">most_important_features</span><span class="p">(</span><span class="n">importances</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1, 2, 0])
</pre></div>
</div>
</div>
</div>
<p>Now weâ€™ll look at a <strong>regression task</strong>. Weâ€™ll try to predict RHOB from the other logs (including the dummy variables). The function guesses that this is a regression task:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GR&#39;</span><span class="p">,</span> <span class="s1">&#39;ILD_log10&#39;</span><span class="p">,</span> <span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="s1">&#39;Random&#39;</span><span class="p">,</span> <span class="s1">&#39;Constant&#39;</span><span class="p">]</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;RHOB&#39;</span><span class="p">]</span>

<span class="n">rf</span><span class="o">.</span><span class="n">feature_importances</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.0887365 , 0.427288  , 0.45634234, 0.02687602, 0.        ])
</pre></div>
</div>
</div>
</div>
<p>The most predictive features are PE and ILD, with GR substantially less important. Again, the random and constant variables are the least important feature.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Using_redflag_with_sklearn.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">ðŸš© Using <code class="docutils literal notranslate"><span class="pre">redflag</span></code> with <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../installation.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">ðŸš© Installation</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Agile Scientific
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://code.agilescientific.com" aria-label="Agile">
                <svg width="200" height="200" version="1.1" viewBox="0 0 187.5 187.5" xmlns="http://www.w3.org/2000/svg">
                <g transform="matrix(3.94 -1.28 1.28 3.94 -906.1 -3676)" style="color-rendering:auto;color:#000000;fill:#14ca29;image-rendering:auto;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;stroke-width:1px;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-transform:none;white-space:normal">
                <path d="m-46.98 936.1q3.515-1.622 6.705-3.244t5.083-2.379 3.028-0.757q1.893 0 3.244 1.298 1.406 1.244 1.406 3.136 0 1.081-0.7029 2.271-0.6489 1.136-1.406 1.46-6.975 2.758-15.36 4.001 1.514 1.406 3.731 3.731t2.325 2.487q0.8111 1.136 2.271 2.812 1.46 1.676 2.001 2.65 0.5948 0.9192 0.5948 2.271 0 1.73-1.298 3.028t-3.352 1.298q-2.055 0-4.65-3.19-2.541-3.19-6.597-11.46-4.109 7.462-5.515 9.841t-2.704 3.623q-1.298 1.19-2.974 1.19-2.001 0-3.352-1.352-1.298-1.406-1.298-2.974 0-1.46 0.5407-2.217 4.975-6.759 10.38-11.73-4.542-0.7029-8.111-1.568t-7.57-2.541q-0.6489-0.3244-1.298-1.46-0.5948-1.19-0.5948-2.163 0-1.893 1.352-3.136 1.406-1.298 3.19-1.298 1.298 0 3.244 0.8111 1.947 0.757 4.921 2.271 3.028 1.46 6.867 3.298-0.7029-3.407-1.19-7.786-0.4326-4.434-0.4326-6.056 0-2.001 1.244-3.407 1.298-1.46 3.298-1.46 1.947 0 3.19 1.46 1.298 1.406 1.298 3.785 0 0.6489-0.2163 2.595-0.1622 1.893-0.5407 4.65-0.3244 2.704-0.757 6.218z" style="fill:#14ca29"/>
                </g>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">ðŸš© Basic usage</a><ul>
<li><a class="reference internal" href="#load-some-data">Load some data</a></li>
<li><a class="reference internal" href="#categorical-or-continuous">Categorical or continuous?</a></li>
<li><a class="reference internal" href="#imbalance-metrics">Imbalance metrics</a></li>
<li><a class="reference internal" href="#outliers">Outliers</a></li>
<li><a class="reference internal" href="#clipping">Clipping</a></li>
<li><a class="reference internal" href="#distribution-shape">Distribution shape</a></li>
<li><a class="reference internal" href="#identical-distribution-assumption">Identical distribution assumption</a><ul>
<li><a class="reference internal" href="#already-split-out-group-arrays">Already split out group arrays</a></li>
</ul>
</li>
<li><a class="reference internal" href="#independence-assumption">Independence assumption</a></li>
<li><a class="reference internal" href="#feature-importance">Feature importance</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>